"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _extends(){return(_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var WebsyPopupDialog=function(){function i(t,e){if(_classCallCheck(this,i),this.options=_extends({},e),t){this.closeOnOutsideClick=!0;var n=document.getElementById(t);this.elementId=t,n.addEventListener("click",this.handleClick.bind(this))}else console.log("No element Id provided for Websy Popup")}return _createClass(i,[{key:"hide",value:function(){document.getElementById(this.elementId).innerHTML=""}},{key:"handleClick",value:function(t){if(t.target.classList.contains("websy-btn")){var e=t.target.getAttribute("data-index"),n=this.options.buttons[e];!0!==n.preventClose&&this.hide(),n.fn&&n.fn(n)}else!0===this.closeOnOutsideClick&&this.hide()}},{key:"render",value:function(){if(this.elementId){var t=document.getElementById(this.elementId),e="\n\t\t\t<div class='websy-popup-dialog-container'>\n\t\t\t\t<div class='websy-popup-dialog'>\n\t\t";if(this.options.title&&(e+="<h1>".concat(this.options.title,"</h1>")),this.options.message&&(e+="<p>".concat(this.options.message,"</p>")),this.closeOnOutsideClick=!0,this.options.buttons){!0!==this.options.allowCloseOnOutsideClick&&(this.closeOnOutsideClick=!1),e+="<div class='websy-popup-button-panel'>";for(var n=0;n<this.options.buttons.length;n++)e+="\n\t\t\t\t\t<button class='websy-btn ".concat((this.options.buttons[n].classes||[]).join(" "),"' data-index='").concat(n,"'>\n\t\t\t\t\t\t").concat(this.options.buttons[n].label,"\n\t\t\t\t\t</button>\n\t\t\t\t");e+="</div>"}e+="\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t",t.innerHTML=e}else console.log("No element Id provided for Websy Popup")}},{key:"show",value:function(t){t&&(this.options=_extends({},t)),this.render()}}]),i}(),WebsyLoadingDialog=function(){function n(t,e){_classCallCheck(this,n),this.options=_extends({},e),t?this.elementId=t:console.log("No element Id provided")}return _createClass(n,[{key:"hide",value:function(){var t=document.getElementById(this.elementId);t.classList.remove("loading"),t.innerHTML=""}},{key:"render",value:function(){if(this.elementId){var t=document.getElementById(this.elementId),e="\n\t\t\t<div class='websy-loading-container ".concat((this.options.classes||[]).join(" "),"'>\n\t\t\t\t<div class='websy-ripple'>\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t\t<h4>").concat(this.options.title||"Loading...","</h4>\n\t\t");if(this.options.messages)for(var n=0;n<this.options.messages.length;n++)e+="<p>".concat(this.options.messages[n],"</p>");e+="\n\t\t\t</div>\t\n    ",t.classList.add("loading"),t.innerHTML=e}else console.log("No element Id provided for Websy Loading Dialog")}},{key:"show",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];t&&(this.options=!0===e?_extends({},t):_extends({},this.options,t)),this.render()}}]),n}(),WebsyNavigationMenu=function(){function i(t,e){if(_classCallCheck(this,i),this.options=_extends({},{orientation:"horizontal"},e),t){var n=document.getElementById(t);n&&(this.elementId=t,n.classList.add("websy-".concat(this.options.orientation,"-list-container")),this.options.classes&&this.options.classes.forEach(function(t){return n.classList.add(t)}),n.addEventListener("click",this.handleClick.bind(this)),this.render())}else console.log("No element Id provided for Websy Menu")}return _createClass(i,[{key:"handleClick",value:function(t){(t.target.classList.contains("websy-menu-icon")||"svg"===t.target.nodeName||"rect"===t.target.nodeName)&&this.toggleMobileMenu(),t.target.classList.contains("trigger-item")&&t.target.classList.contains("websy-menu-header")&&this.toggleMobileMenu("remove"),t.target.classList.contains("websy-menu-mask")&&this.toggleMobileMenu()}},{key:"normaliseString",value:function(t){return t.replace(/-/g,"").replace(/\s/g,"_")}},{key:"render",value:function(){var t=document.getElementById(this.elementId);if(t){var e="";this.options.logo&&(e+="\n          <div id='".concat(this.elementId,'_menuIcon\' class=\'websy-menu-icon\'>\n            <svg width="40" height="40">              \n              <rect x="0" y="0" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="12" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="24" width="40" height="4" rx="2"></rect>\n            </svg>\n            </div>\n          <div class=\'logo ').concat(this.options.logo.classes&&this.options.logo.classes.join(" "),"'><img src='").concat(this.options.logo.url,"'></img></div>\n          <div id='").concat(this.elementId,"_mask' class='websy-menu-mask'></div>\n          <div id=\"").concat(this.elementId,'_menuContainer" class="websy-menu-block-container">\n        ')),e+=this.renderBlock(this.options.items,"main",1),e+="</div>",t.innerHTML=e,this.options.navigator&&this.options.navigator.registerElements(t)}}},{key:"renderBlock",value:function(t,e,n){var i="\n\t\t  <ul class='websy-".concat(this.options.orientation,"-list ").concat("main"!==e?"websy-menu-collapsed":"","' id='").concat(this.elementId,"_").concat(e,"_list'\n\t  ");"main"!==e&&(i+=" data-collapsed='".concat("main"!==e?"true":"false","'")),i+=">";for(var s=0;s<t.length;s++){var o=!0===t[s].default?"active":"",a=this.normaliseString(t[s].text);i+="\n\t\t\t<li class='websy-".concat(this.options.orientation,"-list-item'>\n\t\t\t\t<div class='websy-menu-header ").concat(t[s].classes&&t[s].classes.join(" ")," ").concat(""," ").concat(o,"' \n\t\t\t\t\t\t id='").concat(this.elementId,"_").concat(a,"_label' \n\t\t\t\t\t\t data-id='").concat(a,"' \n\t\t\t\t\t\t data-popout-id='").concat(1<n?e:a,"'\n\t\t\t\t\t\t data-text='").concat(t[s].text,"'\n\t\t\t\t\t\t style='padding-left: ").concat(n*this.options.menuHPadding,"px'\n\t\t\t\t\t\t ").concat(t[s].attributes&&t[s].attributes.join(" "),"\n        >\n      "),"horizontal"===this.options.orientation&&(i+=t[s].text),i+="\n          <span class='selected-bar'></span>\n          <span class='active-square'></span>\n          <span class='".concat(t[s].items&&0<t[s].items.length?"menu-carat":"","'></span>\n      "),"vertical"===this.options.orientation&&(i+="\n          &nbsp;\n        "),i+="    \n\t\t\t\t</div>\n\t\t  ",t[s].items&&(i+=this.renderBlock(t[s].items,a,n+1)),e&&"main"!==e&&(this.options.parentMap[a]||(this.options.parentMap[a]=e)),i+="\n\t\t\t</li>\n\t\t"}return i+="</ul>"}},{key:"toggleMobileMenu",value:function(t){void 0===t&&(t="toggle");var e=document.getElementById("".concat(this.elementId,"_menuIcon"));e&&e.classList[t]("open");var n=document.getElementById("".concat(this.elementId,"_menuContainer"));n&&n.classList[t]("open");var i=document.getElementById("".concat(this.elementId,"_mask"));i&&i.classList[t]("open")}}]),i}(),WebsyForm=function(){function i(t,e){_classCallCheck(this,i);if(this.options=_extends({submit:{text:"Save",classes:""},clearAfterSave:!1,fields:[]},{},{},e),t){this.apiService=new WebsyDesigns.APIService(this.options.url),this.elementId=t;var n=document.getElementById(t);n&&(this.options.classes&&this.options.classes.forEach(function(t){return n.classList.add(t)}),n.addEventListener("click",this.handleClick.bind(this)),n.addEventListener("keyup",this.handleKeyUp.bind(this)),n.addEventListener("keydown",this.handleKeyDown.bind(this)),this.render())}else console.log("No element Id provided")}return _createClass(i,[{key:"handleClick",value:function(t){t.target.classList.contains("submit")&&this.submitForm()}},{key:"handleKeyDown",value:function(t){"enter"===t.key&&this.submitForm()}},{key:"handleKeyUp",value:function(t){}},{key:"render",value:function(){var t=document.getElementById(this.elementId);if(t){var e='\n        <form id="'.concat(this.elementId,'Form">\n      ');this.options.fields.forEach(function(t){e+="\n          ".concat(t.label?'<label for="'.concat(t.field,'">').concat(t.label,"</label>"):"",'\n          <input class="websy-input ').concat(t.classes,'" name="').concat(t.field,'" placeholder="').concat(t.placeholder||"",'"/>\n        ')}),e+='          \n        </form>\n        <button class="websy-btn submit '.concat(this.options.submit.classes,'">').concat(this.options.submit.text||"Save","</button>\n      "),t.innerHTML=e}}},{key:"submitForm",value:function(){var e=this,t=document.getElementById("".concat(this.elementId,"Form")),n=(new FormData(t),{});new FormData(t).forEach(function(t,e){n[e]=t}),this.apiService.add("",n).then(function(t){!0===e.options.clearAfterSave&&e.render()},function(t){return console.log(t)})}}]),i}(),WebsyResultList=function(){function s(t,e){var n=this;_classCallCheck(this,s);if(this.options=_extends({},{listeners:{click:{}}},e),this.elementId=t,this.rows=[],this.apiService=new WebsyDesigns.APIService("/api"),this.templateService=new WebsyDesigns.APIService(""),t){var i=document.getElementById(t);i&&i.addEventListener("click",this.handleClick.bind(this)),"object"===_typeof(e.template)&&e.template.url?this.templateService.get(e.template.url).then(function(t){n.options.template=t,n.render()}):this.render()}else console.log("No element Id provided for Websy Search List")}return _createClass(s,[{key:"findById",value:function(t){console.log("finding",t);for(var e=0;e<this.rows.length;e++)if(console.log(t,this.rows[e].id),this.rows[e].id===t)return this.rows[e];return null}},{key:"handleClick",value:function(t){var e=t.target.getAttribute("data-event"),n=t.target.getAttribute("data-id");t.target.classList.contains("clickable")&&this.options.listeners.click[e]&&(t.stopPropagation(),this.options.listeners.click[e].call(this,t,this.rows[+n]))}},{key:"render",value:function(){var e=this;this.options.entity?this.apiService.get(this.options.entity).then(function(t){e.rows=t.rows,e.resize()}):this.resize()}},{key:"resize",value:function(){var a=this;if(this.options.template){var r="";this.rows.forEach(function(t,e){var n=a.options.template,i=_toConsumableArray(n.matchAll(/(\sdata-event=["|']\w.+)["|']/g));for(var s in i.forEach(function(t){t[0]&&-1<t.index&&(n=n.replace(t[0],"".concat(t[0]," data-id=").concat(e)))}),t){var o=new RegExp("{".concat(s,"}"),"gm");n=n.replace(o,t[s])}r+=n}),document.getElementById(this.elementId).innerHTML=r}}},{key:"data",set:function(t){this.rows=t||[],this.render()}},{key:"date",get:function(){return this.rows}}]),s}(),WebsyPubSub=function(){function n(t,e){_classCallCheck(this,n),this.options=_extends({},e),t?(this.elementId=t,this.subscriptions={}):console.log("No element Id provided")}return _createClass(n,[{key:"publish",value:function(t,e){this.subscriptions[t]&&this.subscriptions[t](e)}},{key:"subscribe",value:function(t,e){this.subscriptions[t]||(this.subscriptions[t]=e)}}]),n}(),APIService=function(){function e(t){_classCallCheck(this,e),this.baseUrl=t}return _createClass(e,[{key:"add",value:function(t,e){var n=this.buildUrl(t);return this.run("POST",n,e)}},{key:"buildUrl",value:function(t,e,n){return void 0===n&&(n=[]),e&&n.push("id:".concat(e)),"".concat(this.baseUrl,"/").concat(t).concat(0<n.length?"?where=".concat(n.join(";")):"")}},{key:"delete",value:function(t,e){var n=this.buildUrl(t,e);return this.run("DELETE",n)}},{key:"get",value:function(t,e,n){var i=this.buildUrl(t,e,n);return this.run("GET",i)}},{key:"update",value:function(t,e,n){var i=this.buildUrl(t,e);return this.run("PUT",i,n)}},{key:"run",value:function(t,s,o){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open(t,s),i.setRequestHeader("Content-Type","application/json"),i.withCredentials=!0,i.onload=function(){var t=i.responseText;if(""!==t&&"null"!==t)try{t=JSON.parse(t)}catch(t){}else t=[];t.err?n(JSON.stringify(t)):e(t)},i.onerror=function(){return n(i.statusText)},o?i.send(JSON.stringify(o)):i.send()})}}]),e}(),WebsyDesigns={WebsyPopupDialog:WebsyPopupDialog,WebsyLoadingDialog:WebsyLoadingDialog,WebsyNavigationMenu:WebsyNavigationMenu,WebsyForm:WebsyForm,WebsyResultList:WebsyResultList,WebsyPubSub:WebsyPubSub,APIService:APIService};