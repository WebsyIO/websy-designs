"use strict";function _extends(){return(_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}).apply(this,arguments)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var WebsyPopupDialog=function(){function s(t,e){if(_classCallCheck(this,s),this.options=_extends({},e),t){this.closeOnOutsideClick=!0;var n=document.getElementById(t);this.elementId=t,n.addEventListener("click",this.handleClick.bind(this))}else console.log("No element Id provided for Websy Popup")}return _createClass(s,[{key:"hide",value:function(){document.getElementById(this.elementId).innerHTML=""}},{key:"handleClick",value:function(t){if(t.target.classList.contains("websy-btn")){var e=t.target.getAttribute("data-index"),n=this.options.buttons[e];!0!==n.preventClose&&this.hide(),n.fn&&n.fn(n)}else!0===this.closeOnOutsideClick&&this.hide()}},{key:"render",value:function(){if(this.elementId){var t=document.getElementById(this.elementId),e="\n\t\t\t<div class='websy-popup-dialog-container'>\n\t\t\t\t<div class='websy-popup-dialog'>\n\t\t";if(this.options.title&&(e+="<h1>".concat(this.options.title,"</h1>")),this.options.message&&(e+="<p>".concat(this.options.message,"</p>")),this.closeOnOutsideClick=!0,this.options.buttons){!0!==this.options.allowCloseOnOutsideClick&&(this.closeOnOutsideClick=!1),e+="<div class='websy-popup-button-panel'>";for(var n=0;n<this.options.buttons.length;n++)e+="\n\t\t\t\t\t<button class='websy-btn ".concat((this.options.buttons[n].classes||[]).join(" "),"' data-index='").concat(n,"'>\n\t\t\t\t\t\t").concat(this.options.buttons[n].label,"\n\t\t\t\t\t</button>\n\t\t\t\t");e+="</div>"}e+="\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t",t.innerHTML=e}else console.log("No element Id provided for Websy Popup")}},{key:"show",value:function(t){t&&(this.options=_extends({},t)),this.render()}}]),s}(),WebsyLoadingDialog=function(){function n(t,e){_classCallCheck(this,n),this.options=_extends({},e),t?this.elementId=t:console.log("No element Id provided")}return _createClass(n,[{key:"hide",value:function(){var t=document.getElementById(this.elementId);t.classList.remove("active"),t.innerHTML=""}},{key:"render",value:function(){if(this.elementId){var t=document.getElementById(this.elementId),e="\n\t\t\t<div class='websy-loading-container ".concat((this.options.classes||[]).join(" "),"'>\n\t\t\t\t<div class='websy-ripple'>\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t\t<h4>").concat(this.options.title||"Loading...","</h4>\n\t\t");if(this.options.messages)for(var n=0;n<this.options.messages.length;n++)e+="<p>".concat(this.options.messages[n],"</p>");e+="\n\t\t\t</div>\t\n    ",t.classList.add("active"),t.innerHTML=e}else console.log("No element Id provided for Websy Loading Dialog")}},{key:"show",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];t&&(this.options=!0===e?_extends({},t):_extends({},this.options,t)),this.render()}}]),n}(),WebsyNavigationMenu=function(){function s(t,e){if(_classCallCheck(this,s),this.options=_extends({},{orientation:"horizontal"},e),t){var n=document.getElementById(t);n&&(this.elementId=t,n.classList.add("websy-".concat(this.options.orientation,"-list-container")),this.options.classes&&this.options.classes.forEach(function(t){return n.classList.add(t)}),n.addEventListener("click",this.handleClick.bind(this)),this.render())}else console.log("No element Id provided for Websy Menu")}return _createClass(s,[{key:"handleClick",value:function(t){(t.target.classList.contains("websy-menu-icon")||"svg"===t.target.nodeName||"rect"===t.target.nodeName)&&this.toggleMobileMenu(),t.target.classList.contains("trigger-item")&&t.target.classList.contains("websy-menu-header")&&this.toggleMobileMenu(),t.target.classList.contains("websy-menu-mask")&&this.toggleMobileMenu()}},{key:"normaliseString",value:function(t){return t.replace(/-/g,"").replace(/\s/g,"_")}},{key:"render",value:function(){var t=document.getElementById(this.elementId);if(t){var e="";this.options.logo&&(e+="\n          <div id='".concat(this.elementId,'_menuIcon\' class=\'websy-menu-icon\'>\n            <svg width="40" height="40">              \n              <rect x="0" y="0" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="12" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="24" width="40" height="4" rx="2"></rect>\n            </svg>\n            </div>\n          <div class=\'logo ').concat(this.options.logo.classes&&this.options.logo.classes.join(" "),"'><img src='").concat(this.options.logo.url,"'></img></div>\n          <div id='").concat(this.elementId,"_mask' class='websy-menu-mask'></div>\n          <div id=\"").concat(this.elementId,'_menuContainer" class="websy-menu-block-container">\n        ')),e+=this.renderBlock(this.options.items,"main",1),e+="</div>",t.innerHTML=e,this.options.navigator&&this.options.navigator.registerElements(t)}}},{key:"renderBlock",value:function(t,e,n){var s="\n\t\t  <ul class='websy-".concat(this.options.orientation,"-list ").concat("main"!==e?"websy-menu-collapsed":"","' id='").concat(this.elementId,"_").concat(e,"_list'\n\t  ");"main"!==e&&(s+=" data-collapsed='".concat("main"!==e?"true":"false","'")),s+=">";for(var i=0;i<t.length;i++){var o=!0===t[i].default?"active":"",a=this.normaliseString(t[i].text);s+="\n\t\t\t<li class='websy-".concat(this.options.orientation,"-list-item'>\n\t\t\t\t<div class='websy-menu-header ").concat(t[i].classes&&t[i].classes.join(" ")," ").concat(""," ").concat(o,"' \n\t\t\t\t\t\t id='").concat(this.elementId,"_").concat(a,"_label' \n\t\t\t\t\t\t data-id='").concat(a,"' \n\t\t\t\t\t\t data-popout-id='").concat(1<n?e:a,"'\n\t\t\t\t\t\t data-text='").concat(t[i].text,"'\n\t\t\t\t\t\t style='padding-left: ").concat(n*this.options.menuHPadding,"px'\n\t\t\t\t\t\t ").concat(t[i].attributes&&t[i].attributes.join(" "),"\n        >\n      "),"horizontal"===this.options.orientation&&(s+=t[i].text),s+="\n          <span class='selected-bar'></span>\n          <span class='active-square'></span>\n          <span class='".concat(t[i].items&&0<t[i].items.length?"menu-carat":"","'></span>\n      "),"vertical"===this.options.orientation&&(s+="\n          &nbsp;\n        "),s+="    \n\t\t\t\t</div>\n\t\t  ",t[i].items&&(s+=this.renderBlock(t[i].items,a,n+1)),e&&"main"!==e&&(this.options.parentMap[a]||(this.options.parentMap[a]=e)),s+="\n\t\t\t</li>\n\t\t"}return s+="</ul>"}},{key:"toggleMobileMenu",value:function(){var t=document.getElementById("".concat(this.elementId,"_menuIcon"));t&&t.classList.toggle("open");var e=document.getElementById("".concat(this.elementId,"_menuContainer"));e&&e.classList.toggle("open");var n=document.getElementById("".concat(this.elementId,"_mask"));n&&n.classList.toggle("open")}}]),s}(),WebsyForm=function(){function s(t,e){_classCallCheck(this,s);if(this.options=_extends({submit:{text:"Save",classes:""},clearAfterSave:!1,fields:[]},{},{},e),t){this.apiService=new WebsyDesigns.APIService("/api"),this.elementId=t;var n=document.getElementById(t);n&&(this.options.classes&&this.options.classes.forEach(function(t){return n.classList.add(t)}),n.addEventListener("click",this.handleClick.bind(this)),n.addEventListener("keyup",this.handleKeyUp.bind(this)),this.render())}else console.log("No element Id provided")}return _createClass(s,[{key:"handleClick",value:function(t){t.target.classList.contains("submit")&&this.submitForm()}},{key:"handleKeyUp",value:function(t){}},{key:"render",value:function(){var t=document.getElementById(this.elementId);if(t){var e='\n        <form id="'.concat(this.elementId,'Form">\n      ');this.options.fields.forEach(function(t){e+="\n          ".concat(t.label?'<label for="'.concat(t.field,'">').concat(t.label,"</label>"):"",'\n          <input class="websy-input ').concat(t.classes,'" name="').concat(t.field,'" placeholder="').concat(t.placeholder||"",'"/>\n        ')}),e+='          \n        </form>\n        <button class="websy-btn submit '.concat(this.options.submit.classes,'">').concat(this.options.submit.text||"Save","</button>\n      "),t.innerHTML=e}}},{key:"submitForm",value:function(){var e=this,t=document.getElementById("".concat(this.elementId,"Form")),n=(new FormData(t),{});new FormData(t).forEach(function(t,e){n[e]=t}),this.apiService.add("products",n).then(function(t){!0===e.options.clearAfterSave&&e.render()},function(t){return console.log(t)})}}]),s}(),WebsySearchList=function(){function n(t,e){if(_classCallCheck(this,n),this.options=_extends({},e),this.elementId=t,this.apiService=new WebsyDesigns.APIService("/api"),t){document.getElementById(t);this.render()}else console.log("No element Id provided for Websy Search List")}return _createClass(n,[{key:"render",value:function(){var o=this;this.options.entity&&this.apiService.get(this.options.entity).then(function(t){if(o.options.template){var i="";t.rows.forEach(function(t){var e=o.options.template;for(var n in t){var s=new RegExp("{".concat(n,"}"),"gm");e=e.replace(s,t[n])}i+=e}),document.getElementById(o.elementId).innerHTML=i}})}},{key:"resize",value:function(){}}]),n}(),WebsyPubSub=function(){function n(t,e){_classCallCheck(this,n),this.options=_extends({},e),t?(this.elementId=t,this.subscriptions={}):console.log("No element Id provided")}return _createClass(n,[{key:"publish",value:function(t,e){this.subscriptions[t]&&this.subscriptions[t](e)}},{key:"subscribe",value:function(t,e){this.subscriptions[t]||(this.subscriptions[t]=e)}}]),n}(),APIService=function(){function e(t){_classCallCheck(this,e),this.baseUrl=t}return _createClass(e,[{key:"add",value:function(t,e){var n=this.buildUrl(t);return this.run("POST",n,e)}},{key:"buildUrl",value:function(t,e,n){return void 0===n&&(n=[]),e&&n.push("id:".concat(e)),"".concat(this.baseUrl,"/").concat(t).concat(0<n.length?"?where=".concat(n.join(";")):"")}},{key:"delete",value:function(t,e){var n=this.buildUrl(t,e);return this.run("DELETE",n)}},{key:"get",value:function(t,e,n){var s=this.buildUrl(t,e,n);return this.run("GET",s)}},{key:"update",value:function(t,e,n){var s=this.buildUrl(t,e);return this.run("PUT",s,n)}},{key:"run",value:function(e,i,o){return new Promise(function(t,n){var s=new XMLHttpRequest;s.open(e,i),s.setRequestHeader("Content-Type","application/json"),s.onload=function(){var e=s.responseText;if(""!==e&&"null"!==e)try{e=JSON.parse(e)}catch(t){e={err:t}}else e=[];e.err?n(JSON.stringify(e)):t(e)},s.onerror=function(){return n(s.statusText)},o?s.send(JSON.stringify(o)):s.send()})}}]),e}(),WebsyDesigns={WebsyPopupDialog:WebsyPopupDialog,WebsyLoadingDialog:WebsyLoadingDialog,WebsyNavigationMenu:WebsyNavigationMenu,WebsyForm:WebsyForm,WebsySearchList:WebsySearchList,WebsyPubSub:WebsyPubSub,APIService:APIService};