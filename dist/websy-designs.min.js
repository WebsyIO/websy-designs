"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _extends(){return(_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var WebsyPopupDialog=function(){function i(t,e){if(_classCallCheck(this,i),this.options=_extends({},e),t){this.closeOnOutsideClick=!0;var n=document.getElementById(t);this.elementId=t,n.addEventListener("click",this.handleClick.bind(this))}else console.log("No element Id provided for Websy Popup")}return _createClass(i,[{key:"hide",value:function(){document.getElementById(this.elementId).innerHTML=""}},{key:"handleClick",value:function(t){if(t.target.classList.contains("websy-btn")){var e=t.target.getAttribute("data-index"),n=this.options.buttons[e];!0!==n.preventClose&&this.hide(),n.fn&&n.fn(n)}else!0===this.closeOnOutsideClick&&this.hide()}},{key:"render",value:function(){if(this.elementId){var t=document.getElementById(this.elementId),e="\n\t\t\t<div class='websy-popup-dialog-container'>\n\t\t\t\t<div class='websy-popup-dialog'>\n\t\t";if(this.options.title&&(e+="<h1>".concat(this.options.title,"</h1>")),this.options.message&&(e+="<p>".concat(this.options.message,"</p>")),this.closeOnOutsideClick=!0,this.options.buttons){!0!==this.options.allowCloseOnOutsideClick&&(this.closeOnOutsideClick=!1),e+="<div class='websy-popup-button-panel'>";for(var n=0;n<this.options.buttons.length;n++)e+="\n\t\t\t\t\t<button class='websy-btn ".concat((this.options.buttons[n].classes||[]).join(" "),"' data-index='").concat(n,"'>\n\t\t\t\t\t\t").concat(this.options.buttons[n].label,"\n\t\t\t\t\t</button>\n\t\t\t\t");e+="</div>"}e+="\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t",t.innerHTML=e}else console.log("No element Id provided for Websy Popup")}},{key:"show",value:function(t){t&&(this.options=_extends({},t)),this.render()}}]),i}(),WebsyLoadingDialog=function(){function n(t,e){_classCallCheck(this,n),this.options=_extends({},e),t?this.elementId=t:console.log("No element Id provided")}return _createClass(n,[{key:"hide",value:function(){var t=document.getElementById(this.elementId);t.classList.remove("loading"),t.innerHTML=""}},{key:"render",value:function(){if(this.elementId){var t=document.getElementById(this.elementId),e="\n\t\t\t<div class='websy-loading-container ".concat((this.options.classes||[]).join(" "),"'>\n\t\t\t\t<div class='websy-ripple'>\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t\t<h4>").concat(this.options.title||"Loading...","</h4>\n\t\t");if(this.options.messages)for(var n=0;n<this.options.messages.length;n++)e+="<p>".concat(this.options.messages[n],"</p>");e+="\n\t\t\t</div>\t\n    ",t.classList.add("loading"),t.innerHTML=e}else console.log("No element Id provided for Websy Loading Dialog")}},{key:"show",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];t&&(this.options=!0===e?_extends({},t):_extends({},this.options,t)),this.render()}}]),n}(),WebsyNavigationMenu=function(){function i(t,e){if(_classCallCheck(this,i),this.options=_extends({},{orientation:"horizontal"},e),t){var n=document.getElementById(t);n&&(this.elementId=t,n.classList.add("websy-".concat(this.options.orientation,"-list-container")),this.options.classes&&this.options.classes.forEach(function(t){return n.classList.add(t)}),n.addEventListener("click",this.handleClick.bind(this)),this.render())}else console.log("No element Id provided for Websy Menu")}return _createClass(i,[{key:"handleClick",value:function(t){(t.target.classList.contains("websy-menu-icon")||"svg"===t.target.nodeName||"rect"===t.target.nodeName)&&this.toggleMobileMenu(),t.target.classList.contains("trigger-item")&&t.target.classList.contains("websy-menu-header")&&this.toggleMobileMenu("remove"),t.target.classList.contains("websy-menu-mask")&&this.toggleMobileMenu()}},{key:"normaliseString",value:function(t){return t.replace(/-/g,"").replace(/\s/g,"_")}},{key:"render",value:function(){var t=document.getElementById(this.elementId);if(t){var e="";this.options.logo&&(e+="\n          <div id='".concat(this.elementId,'_menuIcon\' class=\'websy-menu-icon\'>\n            <svg width="40" height="40">              \n              <rect x="0" y="0" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="12" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="24" width="40" height="4" rx="2"></rect>\n            </svg>\n            </div>\n          <div class=\'logo ').concat(this.options.logo.classes&&this.options.logo.classes.join(" "),"'><img src='").concat(this.options.logo.url,"'></img></div>\n          <div id='").concat(this.elementId,"_mask' class='websy-menu-mask'></div>\n          <div id=\"").concat(this.elementId,'_menuContainer" class="websy-menu-block-container">\n        ')),e+=this.renderBlock(this.options.items,"main",1),e+="</div>",t.innerHTML=e,this.options.navigator&&this.options.navigator.registerElements(t)}}},{key:"renderBlock",value:function(t,e,n){var i="\n\t\t  <ul class='websy-".concat(this.options.orientation,"-list ").concat("main"!==e?"websy-menu-collapsed":"","' id='").concat(this.elementId,"_").concat(e,"_list'\n\t  ");"main"!==e&&(i+=" data-collapsed='".concat("main"!==e?"true":"false","'")),i+=">";for(var s=0;s<t.length;s++){var o=!0===t[s].default?"active":"",a=this.normaliseString(t[s].text);i+="\n\t\t\t<li class='websy-".concat(this.options.orientation,"-list-item'>\n\t\t\t\t<div class='websy-menu-header ").concat(t[s].classes&&t[s].classes.join(" ")," ").concat(""," ").concat(o,"' \n\t\t\t\t\t\t id='").concat(this.elementId,"_").concat(a,"_label' \n\t\t\t\t\t\t data-id='").concat(a,"' \n\t\t\t\t\t\t data-popout-id='").concat(1<n?e:a,"'\n\t\t\t\t\t\t data-text='").concat(t[s].text,"'\n\t\t\t\t\t\t style='padding-left: ").concat(n*this.options.menuHPadding,"px'\n\t\t\t\t\t\t ").concat(t[s].attributes&&t[s].attributes.join(" "),"\n        >\n      "),"horizontal"===this.options.orientation&&(i+=t[s].text),i+="\n          <span class='selected-bar'></span>\n          <span class='active-square'></span>\n          <span class='".concat(t[s].items&&0<t[s].items.length?"menu-carat":"","'></span>\n      "),"vertical"===this.options.orientation&&(i+="\n          &nbsp;\n        "),i+="    \n\t\t\t\t</div>\n\t\t  ",t[s].items&&(i+=this.renderBlock(t[s].items,a,n+1)),e&&"main"!==e&&(this.options.parentMap[a]||(this.options.parentMap[a]=e)),i+="\n\t\t\t</li>\n\t\t"}return i+="</ul>"}},{key:"toggleMobileMenu",value:function(t){void 0===t&&(t="toggle");var e=document.getElementById("".concat(this.elementId,"_menuIcon"));e&&e.classList[t]("open");var n=document.getElementById("".concat(this.elementId,"_menuContainer"));n&&n.classList[t]("open");var i=document.getElementById("".concat(this.elementId,"_mask"));i&&i.classList[t]("open")}}]),i}(),WebsyForm=function(){function s(t,e){_classCallCheck(this,s);var n={submit:{text:"Save",classes:""},clearAfterSave:!1,fields:[],onSuccess:function(t){},onError:function(t){console.log("Error submitting form data:",t)}};if(GlobalPubSub.subscribe("recaptchaready",this.recaptchaReady.bind(this)),this.recaptchaResult=null,this.options=_extends(n,{},{},e),t){this.apiService=new WebsyDesigns.APIService(""),this.elementId=t;var i=document.getElementById(t);i&&(this.options.classes&&this.options.classes.forEach(function(t){return i.classList.add(t)}),i.addEventListener("click",this.handleClick.bind(this)),i.addEventListener("keyup",this.handleKeyUp.bind(this)),i.addEventListener("keydown",this.handleKeyDown.bind(this)),this.render())}else console.log("No element Id provided")}return _createClass(s,[{key:"checkRecaptcha",value:function(){var t=this;return new Promise(function(e,n){!0===t.options.useRecaptcha?t.recaptchaValue?t.apiService.add("/google/checkrecaptcha",JSON.stringify({grecaptcharesponse:t.recaptchaValue})).then(function(t){t.success&&!0===t.success?e(!0):n(!1)}):n(!1):e(!0)})}},{key:"handleClick",value:function(t){t.target.classList.contains("submit")&&this.submitForm()}},{key:"handleKeyDown",value:function(t){"enter"===t.key&&this.submitForm()}},{key:"handleKeyUp",value:function(t){}},{key:"recaptchaReady",value:function(){document.getElementById("".concat(this.elementId,"_recaptcha"))&&grecaptcha.render("".concat(this.elementId,"_recaptcha"),{sitekey:ENVIRONMENT.RECAPTCHA_KEY,callback:this.validateRecaptcha.bind(this)})}},{key:"render",value:function(){var t=document.getElementById(this.elementId);if(t){var e='\n        <form id="'.concat(this.elementId,'Form">\n      ');this.options.fields.forEach(function(t){e+="\n          ".concat(t.label?'<label for="'.concat(t.field,'">').concat(t.label,"</label>"):"","\n          <input \n            ").concat(!0===t.required?"required":"",' \n            type="').concat(t.type||"text",'" \n            class="websy-input ').concat(t.classes,'" \n            name="').concat(t.field,'" \n            placeholder="').concat(t.placeholder||"",'"\n            oninvalidx="this.setCustomValidity(\'').concat(t.invalidMessage||"Please fill in this field.","')\"\n          />\n        ")}),e+="          \n        </form>\n      ",!0===this.options.useRecaptcha&&(e+="\n          <div id='".concat(this.elementId,"_recaptcha'></div>\n        ")),e+='\n        <button class="websy-btn submit '.concat(this.options.submit.classes,'">').concat(this.options.submit.text||"Save","</button>\n      "),t.innerHTML=e,!0===this.options.useRecaptcha&&"undefined"!=typeof grecaptcha&&this.recaptchaReady()}}},{key:"submitForm",value:function(){var e=this,i=document.getElementById("".concat(this.elementId,"Form"));!0===i.reportValidity()&&this.checkRecaptcha().then(function(t){if(!0===t){new FormData(i);var n={};new FormData(i).forEach(function(t,e){n[e]=t}),e.apiService.add(e.options.url,n).then(function(t){!0===e.options.clearAfterSave&&i.reset(),e.options.onSuccess.call(e,t)},function(t){console.log("Error submitting form data:",t),e.options.onError.call(e,t)})}else console.log("bad recaptcha")})}},{key:"validateRecaptcha",value:function(t){this.recaptchaValue=t}}]),s}(),WebsyResultList=function(){function s(t,e){var n=this;_classCallCheck(this,s);if(this.options=_extends({},{listeners:{click:{}}},e),this.elementId=t,this.rows=[],this.apiService=new WebsyDesigns.APIService("/api"),this.templateService=new WebsyDesigns.APIService(""),t){var i=document.getElementById(t);i&&i.addEventListener("click",this.handleClick.bind(this)),"object"===_typeof(e.template)&&e.template.url?this.templateService.get(e.template.url).then(function(t){n.options.template=t,n.render()}):this.render()}else console.log("No element Id provided for Websy Search List")}return _createClass(s,[{key:"findById",value:function(t){console.log("finding",t);for(var e=0;e<this.rows.length;e++)if(console.log(t,this.rows[e].id),this.rows[e].id===t)return this.rows[e];return null}},{key:"handleClick",value:function(t){var e=this;if(t.target.classList.contains("clickable")){var n=t.target.getAttribute("data-event");if(n){n=n.split("(");var i,s=[],o=t.target.getAttribute("data-id");if(n[1]&&(n[1]=n[1].replace(")",""),s=n[1].split(",")),n=n[0],s=s.map(function(t){return"string"!=typeof t&&"number"!=typeof t?e.rows[+o]&&(t=e.rows[+o][t]):"string"==typeof t&&(t=t.replace(/"/g,"").replace(/'/g,"")),t}),t.target.classList.contains("clickable")&&this.options.listeners.click[n])t.stopPropagation(),(i=this.options.listeners.click[n]).call.apply(i,[this,t,this.rows[+o]].concat(_toConsumableArray(s)))}}}},{key:"render",value:function(){var e=this;this.options.entity?this.apiService.get(this.options.entity).then(function(t){e.rows=t.rows,e.resize()}):this.resize()}},{key:"resize",value:function(){var s=this;if(this.options.template){var o="";this.rows.forEach(function(r,e){var c="".concat(0<e?"--\x3e":"").concat(s.options.template).concat(e<s.rows.length-1?"\x3c!--":"");_toConsumableArray(c.matchAll(/<\s*if[^>]*>([\s\S]*?)<\s*\/\s*if>/g)).forEach(function(t){if(t[0]&&-1<t.index){var e=t[0].match(/(\scondition=["|']\w.+)["|']/g);if(e&&e[0]){var n=e[0].trim().replace("condition=","");'"'===n.split("")[0]?n=n.replace(/"/g,""):"'"===n.split("")[0]&&(n=n.replace(/'/g,""));var i=[],s=!0;-1!==n.indexOf("===")?i=n.split("==="):-1!==n.indexOf("!==")?(i=n.split("!=="),s=!1):-1!==n.indexOf("==")?i=n.split("=="):-1!==n.indexOf("!=")&&(i=n.split("!="),s=!1);var o=!0;if(2===i.length&&(isNaN(i[1])||(i[1]=+i[1]),"true"===i[1]&&(i[1]=!0),"false"===i[1]&&(i[1]=!1),"string"==typeof i[1]&&(-1!==i[1].indexOf('"')?i[1]=i[1].replace(/"/g,""):-1!==i[1].indexOf("'")&&(i[1]=i[1].replace(/'/g,""))),!0===s?void 0!==r[i[0]]&&r[i[0]]===i[1]?o=!1:i[0]===i[1]&&(o=!1):!1===s&&void 0!==r[i[0]]&&r[i[0]]!==i[1]&&(o=!1)),!0===o)console.log("removing all"),console.log("match is",t[0]),c=c.replace(t[0],"");else{console.log("removing if tags");var a=t[0];a=a.replace("</if>","").replace(/<\s*if[^>]*>/g,""),c=c.replace(t[0],a)}console.log("conditionMatch",n)}}});var t=_toConsumableArray(c.matchAll(/(\sdata-event=["|']\w.+)["|']/g));for(var n in t.forEach(function(t){t[0]&&-1<t.index&&(c=c.replace(t[0],"".concat(t[0]," data-id=").concat(e)))}),r){var i=new RegExp("{".concat(n,"}"),"gm");c=c.replace(i,r[n])}o+=c}),document.getElementById(this.elementId).innerHTML=o.replace(/\n/g,"")}}},{key:"data",set:function(t){this.rows=t||[],this.render()}},{key:"date",get:function(){return this.rows}}]),s}(),WebsyPubSub=function(){function n(t,e){_classCallCheck(this,n),this.options=_extends({},e),t?(this.elementId=t,this.subscriptions={}):console.log("No element Id provided")}return _createClass(n,[{key:"publish",value:function(t,e){this.subscriptions[t]&&this.subscriptions[t](e)}},{key:"subscribe",value:function(t,e){this.subscriptions[t]||(this.subscriptions[t]=e)}}]),n}(),APIService=function(){function e(t){_classCallCheck(this,e),this.baseUrl=t}return _createClass(e,[{key:"add",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=this.buildUrl(t);return this.run("POST",i,e,n)}},{key:"buildUrl",value:function(t,e,n){return void 0===n&&(n=[]),e&&n.push("id:".concat(e)),"".concat(this.baseUrl,"/").concat(t).concat(0<n.length?"?where=".concat(n.join(";")):"")}},{key:"delete",value:function(t,e){var n=this.buildUrl(t,e);return this.run("DELETE",n)}},{key:"get",value:function(t,e,n){var i=this.buildUrl(t,e,n);return this.run("GET",i)}},{key:"update",value:function(t,e,n){var i=this.buildUrl(t,e);return this.run("PUT",i,n)}},{key:"runs",value:function(t,e,n){3<arguments.length&&void 0!==arguments[3]&&arguments[3];return fetch(e,{method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(n)}).then(function(t){return t.json()})}},{key:"run",value:function(t,s,o){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return new Promise(function(e,n){var i=new XMLHttpRequest;i.open(t,s),i.setRequestHeader("Content-Type","application/json"),i.responseType="text",a.responseType&&(i.responseType=a.responseType),i.withCredentials=!0,console.log("using this"),i.onload=function(){var t="text"===i.responseType?i.responseText:i.response;if(""!==t&&"null"!==t)try{t=JSON.parse(t)}catch(t){}else t=[];t.err?n(JSON.stringify(t)):e(t)},i.onerror=function(){return n(i.statusText)},o?i.send(JSON.stringify(o)):i.send()})}}]),e}(),WebsyDesigns={WebsyPopupDialog:WebsyPopupDialog,WebsyLoadingDialog:WebsyLoadingDialog,WebsyNavigationMenu:WebsyNavigationMenu,WebsyForm:WebsyForm,WebsyResultList:WebsyResultList,WebsyPubSub:WebsyPubSub,APIService:APIService},GlobalPubSub=new WebsyPubSub("empty",{});function recaptchaReadyCallBack(){GlobalPubSub.publish("recaptchaready")}var rcs=document.createElement("script");rcs.src="//www.google.com/recaptcha/api.js?onload=recaptchaReadyCallBack",document.getElementsByTagName("body")[0].appendChild(rcs);var pps=document.createElement("script");rcs.src="//www.paypal.com/sdk/js",document.getElementsByTagName("body")[0].appendChild(pps);