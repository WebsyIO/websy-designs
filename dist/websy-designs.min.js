"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var WebsyPopupDialog=function(){function s(e,t){if(_classCallCheck(this,s),this.options=_extends({},t),e){this.closeOnOutsideClick=!0;var n=document.getElementById(e);this.elementId=e,n.addEventListener("click",this.handleClick.bind(this))}else console.log("No element Id provided for Websy Popup")}return _createClass(s,[{key:"hide",value:function(){document.getElementById(this.elementId).innerHTML=""}},{key:"handleClick",value:function(e){if(e.target.classList.contains("websy-btn")){var t=e.target.getAttribute("data-index"),n=this.options.buttons[t];!0!==n.preventClose&&this.hide(),n.fn&&n.fn(n)}else!0===this.closeOnOutsideClick&&this.hide()}},{key:"render",value:function(){if(this.elementId){var e=document.getElementById(this.elementId),t="\n\t\t\t<div class='websy-popup-dialog-container'>\n\t\t\t\t<div class='websy-popup-dialog'>\n\t\t";if(this.options.title&&(t+="<h1>".concat(this.options.title,"</h1>")),this.options.message&&(t+="<p>".concat(this.options.message,"</p>")),this.closeOnOutsideClick=!0,this.options.buttons){!0!==this.options.allowCloseOnOutsideClick&&(this.closeOnOutsideClick=!1),t+="<div class='websy-popup-button-panel'>";for(var n=0;n<this.options.buttons.length;n++)t+="\n\t\t\t\t\t<button class='websy-btn ".concat((this.options.buttons[n].classes||[]).join(" "),"' data-index='").concat(n,"'>\n\t\t\t\t\t\t").concat(this.options.buttons[n].label,"\n\t\t\t\t\t</button>\n\t\t\t\t");t+="</div>"}t+="\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t",e.innerHTML=t}else console.log("No element Id provided for Websy Popup")}},{key:"show",value:function(e){e&&(this.options=_extends({},e)),this.render()}}]),s}(),WebsyLoadingDialog=function(){function n(e,t){_classCallCheck(this,n),this.options=_extends({},t),e?this.elementId=e:console.log("No element Id provided")}return _createClass(n,[{key:"hide",value:function(){var e=document.getElementById(this.elementId);e.classList.remove("loading"),e.innerHTML=""}},{key:"render",value:function(){if(this.elementId){var e=document.getElementById(this.elementId),t="\n\t\t\t<div class='websy-loading-container ".concat((this.options.classes||[]).join(" "),"'>\n\t\t\t\t<div class='websy-ripple'>\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div></div>\n\t\t\t\t</div>\n\t\t\t\t<h4>").concat(this.options.title||"Loading...","</h4>\n\t\t");if(this.options.messages)for(var n=0;n<this.options.messages.length;n++)t+="<p>".concat(this.options.messages[n],"</p>");t+="\n\t\t\t</div>\t\n    ",e.classList.add("loading"),e.innerHTML=t}else console.log("No element Id provided for Websy Loading Dialog")}},{key:"show",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e&&(this.options=!0===t?_extends({},e):_extends({},this.options,e)),this.render()}}]),n}(),WebsyNavigationMenu=function(){function s(e,t){if(_classCallCheck(this,s),this.options=_extends({},{orientation:"horizontal"},t),e){var n=document.getElementById(e);n&&(this.elementId=e,n.classList.add("websy-".concat(this.options.orientation,"-list-container")),this.options.classes&&this.options.classes.forEach(function(e){return n.classList.add(e)}),n.addEventListener("click",this.handleClick.bind(this)),this.render())}else console.log("No element Id provided for Websy Menu")}return _createClass(s,[{key:"handleClick",value:function(e){(e.target.classList.contains("websy-menu-icon")||"svg"===e.target.nodeName||"rect"===e.target.nodeName)&&this.toggleMobileMenu(),e.target.classList.contains("trigger-item")&&e.target.classList.contains("websy-menu-header")&&this.toggleMobileMenu("remove"),e.target.classList.contains("websy-menu-mask")&&this.toggleMobileMenu()}},{key:"normaliseString",value:function(e){return e.replace(/-/g,"").replace(/\s/g,"_")}},{key:"render",value:function(){var e=document.getElementById(this.elementId);if(e){var t="";this.options.logo&&(t+="\n          <div id='".concat(this.elementId,'_menuIcon\' class=\'websy-menu-icon\'>\n            <svg viewbox="0 0 40 40" width="40" height="40">              \n              <rect x="0" y="0" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="12" width="40" height="4" rx="2"></rect>\n              <rect x="0" y="24" width="40" height="4" rx="2"></rect>\n            </svg>\n            </div>\n          <div \n            class=\'logo ').concat(this.options.logo.classes&&this.options.logo.classes.join(" ")||"","'\n            ").concat(this.options.logo.attributes&&this.options.logo.attributes.join(" "),"\n          >\n          <img src='").concat(this.options.logo.url,"'></img>\n          </div>\n          <div id='").concat(this.elementId,"_mask' class='websy-menu-mask'></div>\n          <div id=\"").concat(this.elementId,'_menuContainer" class="websy-menu-block-container">\n        ')),t+=this.renderBlock(this.options.items,"main",1),t+="</div>",e.innerHTML=t,this.options.navigator&&this.options.navigator.registerElements(e)}}},{key:"renderBlock",value:function(e,t,n){var s="\n\t\t  <ul class='websy-".concat(this.options.orientation,"-list ").concat("main"!==t?"websy-menu-collapsed":"","' id='").concat(this.elementId,"_").concat(t,"_list'\n\t  ");"main"!==t&&(s+=" data-collapsed='".concat("main"!==t?"true":"false","'")),s+=">";for(var i=0;i<e.length;i++){var o=!0===e[i].default?"active":"",a=this.normaliseString(e[i].text);s+="\n\t\t\t<li class='websy-".concat(this.options.orientation,"-list-item'>\n\t\t\t\t<div class='websy-menu-header ").concat(e[i].classes&&e[i].classes.join(" ")," ").concat(""," ").concat(o,"' \n\t\t\t\t\t\t id='").concat(this.elementId,"_").concat(a,"_label' \n\t\t\t\t\t\t data-id='").concat(a,"' \n\t\t\t\t\t\t data-popout-id='").concat(1<n?t:a,"'\n\t\t\t\t\t\t data-text='").concat(e[i].text,"'\n\t\t\t\t\t\t style='padding-left: ").concat(n*this.options.menuHPadding,"px'\n\t\t\t\t\t\t ").concat(e[i].attributes&&e[i].attributes.join(" "),"\n        >\n      "),"horizontal"===this.options.orientation&&(s+=e[i].text),s+="\n          <span class='selected-bar'></span>\n          <span class='active-square'></span>\n          <span class='".concat(e[i].items&&0<e[i].items.length?"menu-carat":"","'></span>\n      "),"vertical"===this.options.orientation&&(s+="\n          &nbsp;\n        "),s+="    \n\t\t\t\t</div>\n\t\t  ",e[i].items&&(s+=this.renderBlock(e[i].items,a,n+1)),t&&"main"!==t&&(this.options.parentMap[a]||(this.options.parentMap[a]=t)),s+="\n\t\t\t</li>\n\t\t"}return s+="</ul>"}},{key:"toggleMobileMenu",value:function(e){void 0===e&&(e="toggle");var t=document.getElementById("".concat(this.elementId,"_menuIcon"));t&&t.classList[e]("open");var n=document.getElementById("".concat(this.elementId,"_menuContainer"));n&&n.classList[e]("open");var s=document.getElementById("".concat(this.elementId,"_mask"));s&&s.classList[e]("open")}}]),s}(),WebsyForm=function(){function i(e,t){_classCallCheck(this,i);var n={submit:{text:"Save",classes:""},clearAfterSave:!1,fields:[],onSuccess:function(e){},onError:function(e){console.log("Error submitting form data:",e)}};if(GlobalPubSub.subscribe("recaptchaready",this.recaptchaReady.bind(this)),this.recaptchaResult=null,this.options=_extends(n,{},{},t),e){this.apiService=new WebsyDesigns.APIService(""),this.elementId=e;var s=document.getElementById(e);s&&(this.options.classes&&this.options.classes.forEach(function(e){return s.classList.add(e)}),s.addEventListener("click",this.handleClick.bind(this)),s.addEventListener("keyup",this.handleKeyUp.bind(this)),s.addEventListener("keydown",this.handleKeyDown.bind(this)),this.render())}else console.log("No element Id provided")}return _createClass(i,[{key:"checkRecaptcha",value:function(){var e=this;return new Promise(function(t,n){!0===e.options.useRecaptcha?e.recaptchaValue?e.apiService.add("/google/checkrecaptcha",JSON.stringify({grecaptcharesponse:e.recaptchaValue})).then(function(e){e.success&&!0===e.success?t(!0):n(!1)}):n(!1):t(!0)})}},{key:"handleClick",value:function(e){e.target.classList.contains("submit")&&this.submitForm()}},{key:"handleKeyDown",value:function(e){"enter"===e.key&&this.submitForm()}},{key:"handleKeyUp",value:function(e){}},{key:"recaptchaReady",value:function(){document.getElementById("".concat(this.elementId,"_recaptcha"))&&grecaptcha.render("".concat(this.elementId,"_recaptcha"),{sitekey:ENVIRONMENT.RECAPTCHA_KEY,callback:this.validateRecaptcha.bind(this)})}},{key:"render",value:function(e,t){var n=this,s=document.getElementById(this.elementId);if(s){var i='\n        <form id="'.concat(this.elementId,'Form">\n      ');this.options.fields.forEach(function(e){"longtext"===e.type?i+="\n            ".concat(e.label?'<label for="'.concat(e.field,'">').concat(e.label,"</label>"):"",'\n            <textarea\n              id="').concat(n.elementId,"_input_").concat(e.field,'"\n              ').concat(!0===e.required?"required":"",' \n              placeholder="').concat(e.placeholder||"",'"\n              name="').concat(e.field,'" \n              class="websy-input websy-textarea ').concat(e.classes,'"\n            ></textarea>\n          '):i+="\n            ".concat(e.label?'<label for="'.concat(e.field,'">').concat(e.label,"</label>"):"",'\n            <input \n              id="').concat(n.elementId,"_input_").concat(e.field,'"\n              ').concat(!0===e.required?"required":"",' \n              type="').concat(e.type||"text",'" \n              class="websy-input ').concat(e.classes,'" \n              name="').concat(e.field,'" \n              placeholder="').concat(e.placeholder||"",'"\n              value="').concat(e.value||"",'"\n              oninvalidx="this.setCustomValidity(\'').concat(e.invalidMessage||"Please fill in this field.","')\"\n            />\n          ")}),i+="          \n        </form>\n      ",!0===this.options.useRecaptcha&&(i+="\n          <div id='".concat(this.elementId,"_recaptcha'></div>\n        ")),i+='\n        <button class="websy-btn submit '.concat(this.options.submit.classes,'">').concat(this.options.submit.text||"Save","</button>\n      "),s.innerHTML=i,!0===this.options.useRecaptcha&&"undefined"!=typeof grecaptcha&&this.recaptchaReady()}}},{key:"submitForm",value:function(){var t=this,s=document.getElementById("".concat(this.elementId,"Form"));!0===s.reportValidity()&&this.checkRecaptcha().then(function(e){if(!0===e){new FormData(s);var n={};new FormData(s).forEach(function(e,t){n[t]=e}),t.options.url?t.apiService.add(t.options.url,n).then(function(e){!0===t.options.clearAfterSave&&s.reset(),t.options.onSuccess.call(t,e)},function(e){console.log("Error submitting form data:",e),t.options.onError.call(t,e)}):t.options.submitFn&&(t.options.submitFn(n),!0===t.options.clearAfterSave&&s.reset())}else console.log("bad recaptcha")})}},{key:"validateRecaptcha",value:function(e){this.recaptchaValue=e}},{key:"data",set:function(n){var s=this;this.options.fields||(this.options.fields=[]);var e=function(t){s.options.fields.forEach(function(e){e.field===t&&(e.value=n[t],document.getElementById("".concat(s.elementId,"_input_").concat(e.field)).value=e.value)})};for(var t in n)e(t);this.render()}}]),i}(),WebsyDatePicker=function(){function i(e,t){_classCallCheck(this,i);var n={defaultRange:2,ranges:[{label:"Today",range:[new Date]},{label:"Yesterday",range:[new Date]},{label:"Last 7 Days",range:[new Date]},{label:"This Month",range:[new Date]},{label:"This Year",range:[new Date]}]};if(this.options=_extends({},n,t),this.selectedRange=this.options.defaultRange||0,e){var s=document.getElementById(e);s?(this.elementId=e,s.addEventListener("click",this.handleClick.bind(this)),this.render()):console.log("No element found with Id",e)}else console.log("No element Id provided")}return _createClass(i,[{key:"close",value:function(){var e=document.getElementById("".concat(this.elementId,"_mask")),t=document.getElementById("".concat(this.elementId,"_content"));e.classList.remove("active"),t.classList.remove("active")}},{key:"handleClick",value:function(e){if(e.target.classList.contains("websy-date-picker-header"))this.open();else if(e.target.classList.contains("websy-date-picker-mask"))this.close();else if(e.target.classList.contains("websy-date-picker-range")){var t=e.target.getAttribute("data-index");this.updateRange(t)}}},{key:"open",value:function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];var t=document.getElementById("".concat(this.elementId,"_mask")),n=document.getElementById("".concat(this.elementId,"_content"));t.classList.add("active"),n.classList.add("active")}},{key:"render",value:function(){var n=this;if(this.elementId){var e=document.getElementById(this.elementId),t="\n\t\t\t<div class='websy-date-picker-container'>\n        <div class='websy-date-picker-header'>\n          <span id='".concat(this.elementId,"_selectedRange'>").concat(this.options.ranges[this.selectedRange].label,'</span>\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"/></svg>\n        </div>\n        <div id=\'').concat(this.elementId,"_mask' class='websy-date-picker-mask'></div>\n        <div id='").concat(this.elementId,"_content' class='websy-date-picker-content'>\n          <div class='websy-date-picker-ranges'>\n            <ul>\n              ").concat(this.options.ranges.map(function(e,t){return"\n                <li data-index='".concat(t,"' class='websy-date-picker-range ").concat(t===n.selectedRange?"active":"","'>").concat(e.label,"</li>\n              ")}).join(""),"\n            </ul>\n          </div>\x3c!--\n          --\x3e<div class='websy-date-picker-custom'></div>\n        </div>\n      </div>\n    ");e.innerHTML=t}else console.log("No element Id provided for Websy Loading Dialog")}},{key:"updateRange",value:function(e){if(e!==this.selectedRange){this.selectedRange=e;for(var t=this.options.ranges[e],n=document.getElementById(this.elementId),s=document.getElementById("".concat(this.elementId,"_selectedRange")),i=n.querySelectorAll(".websy-date-picker-range"),o=0;o<i.length;o++)i[o].classList.remove("active"),o===e&&i[o].classList.add("active");s&&(s.innerHTML=t.label,this.options.onRangeChanged&&this.options.onRangeChanged(t),this.close())}}}]),i}(),WebsyDropdown=function(){function s(e,t){_classCallCheck(this,s);if(this.options=_extends({},{multiSelect:!1,allowClear:!0,style:"plain",items:[],label:""},t),this.selectedItems=[],e){var n=document.getElementById(e);n?(this.elementId=e,n.addEventListener("click",this.handleClick.bind(this)),this.render()):console.log("No element found with Id",e)}else console.log("No element Id provided")}return _createClass(s,[{key:"close",value:function(){var e=document.getElementById("".concat(this.elementId,"_mask")),t=document.getElementById("".concat(this.elementId,"_content"));e.classList.remove("active"),t.classList.remove("active")}},{key:"handleClick",value:function(e){if(e.target.classList.contains("websy-dropdown-header"))this.open();else if(e.target.classList.contains("websy-dropdown-mask"))this.close();else if(e.target.classList.contains("websy-dropdown-item")){var t=e.target.getAttribute("data-index");this.updateSelected(+t)}}},{key:"open",value:function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];var t=document.getElementById("".concat(this.elementId,"_mask")),n=document.getElementById("".concat(this.elementId,"_content"));t.classList.add("active"),n.classList.add("active")}},{key:"render",value:function(){var n=this;if(this.elementId){var e=document.getElementById(this.elementId);console.log("rendering dropdown",this.selectedItems),console.log(1===this.selectedItems.length?"one-selected":"");var t="\n      <div class='websy-dropdown-container'>\n        <div id='".concat(this.elementId,"_header' class='websy-dropdown-header ").concat(1===this.selectedItems.length?"one-selected":"","'>\n          <span class='websy-dropdown-header-label'>").concat(this.options.label,"</span>\n          <span class='websy-dropdown-header-value' id='").concat(this.elementId,"_selectedItems'>").concat(this.selectedItems.map(function(e){return n.options.items[e].label}).join(","),'</span>\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.677 18.52c.914 1.523-.183 3.472-1.967 3.472h-19.414c-1.784 0-2.881-1.949-1.967-3.472l9.709-16.18c.891-1.483 3.041-1.48 3.93 0l9.709 16.18z"/></svg>\n        </div>\n        <div id=\'').concat(this.elementId,"_mask' class='websy-dropdown-mask'></div>\n        <div id='").concat(this.elementId,"_content' class='websy-dropdown-content'>\n          <div class='websy-dropdown-items'>\n            <ul>\n              ").concat(this.options.items.map(function(e,t){return"\n                <li data-index='".concat(t,"' class='websy-dropdown-item ").concat(-1!==n.selectedItems.indexOf(t)?"active":"","'>").concat(e.label,"</li>\n              ")}).join(""),"\n            </ul>\n          </div>\x3c!--\n          --\x3e<div class='websy-dropdown-custom'></div>\n        </div>\n      </div>\n    ");e.innerHTML=t}else console.log("No element Id provided for Websy Loading Dialog")}},{key:"updateSelected",value:function(e){if(null!=e){if(-1!==this.selectedItems.indexOf(e))return;!1===this.options.multiSelect?this.selectedItems=[e]:this.selectedItems.push(e)}for(var t=this.options.items[e],n=document.getElementById(this.elementId),s=document.getElementById("".concat(this.elementId,"_header")),i=document.getElementById("".concat(this.elementId,"_selectedItems")),o=n.querySelectorAll(".websy-dropdown-item"),a=0;a<o.length;a++)o[a].classList.remove("active"),-1!==this.selectedItems.indexOf(a)&&o[a].classList.add("active");s&&(s.classList.remove("one-selected"),s.classList.remove("multi-selected"),1===this.selectedItems.length?s.classList.add("one-selected"):1<this.selectedItems.length&&s.classList.add("multi-selected")),i&&(1===this.selectedItems.length?i.innerHTML=t.label:1<this.selectedItems.length?i.innerHTML="".concat(this.selectedItems.length," selected"):(console.log("we got here for some reason"),i.innerHTML=""),this.options.onItemSelected&&this.options.onItemSelected(t,this.selectedItems,this.options.items),this.close())}},{key:"selections",set:function(e){this.selectedItems=e||[]}},{key:"data",set:function(e){this.options.items=e||[],this.render()},get:function(){return this.options.items}}]),s}(),WebsyResultList=function(){function i(e,t){var n=this;_classCallCheck(this,i);if(this.options=_extends({},{listeners:{click:{}}},t),this.elementId=e,this.rows=[],this.apiService=new WebsyDesigns.APIService("/api"),this.templateService=new WebsyDesigns.APIService(""),e){var s=document.getElementById(e);s&&s.addEventListener("click",this.handleClick.bind(this)),"object"===_typeof(t.template)&&t.template.url?this.templateService.get(t.template.url).then(function(e){n.options.template=e,n.render()}):this.render()}else console.log("No element Id provided for Websy Search List")}return _createClass(i,[{key:"appendData",value:function(e){this.rows=this.rows.concat(e);var t=this.buildHTML(e);document.getElementById(this.elementId).innerHTML+=t.replace(/\n/g,"")}},{key:"buildHTML",value:function(i){var o=this,a="";return this.options.template&&(0<i.length?i.forEach(function(c,t){var l="".concat(0<t?"--\x3e":"").concat(o.options.template).concat(t<i.length-1?"\x3c!--":"");_toConsumableArray(l.matchAll(/<\s*if[^>]*>([\s\S]*?)<\s*\/\s*if>/g)).forEach(function(e){if(e[0]&&-1<e.index){var t=e[0].match(/(\scondition=["|']\w.+)["|']/g);if(t&&t[0]){var n=t[0].trim().replace("condition=","");'"'===n.split("")[0]?n=n.replace(/"/g,""):"'"===n.split("")[0]&&(n=n.replace(/'/g,""));var s=[],i=!0;-1!==n.indexOf("===")?s=n.split("==="):-1!==n.indexOf("!==")?(s=n.split("!=="),i=!1):-1!==n.indexOf("==")?s=n.split("=="):-1!==n.indexOf("!=")&&(s=n.split("!="),i=!1);var o=!0;if(2===s.length&&(isNaN(s[1])||(s[1]=+s[1]),"true"===s[1]&&(s[1]=!0),"false"===s[1]&&(s[1]=!1),"string"==typeof s[1]&&(-1!==s[1].indexOf('"')?s[1]=s[1].replace(/"/g,""):-1!==s[1].indexOf("'")&&(s[1]=s[1].replace(/'/g,""))),!0===i?void 0!==c[s[0]]&&c[s[0]]===s[1]?o=!1:s[0]===s[1]&&(o=!1):!1===i&&void 0!==c[s[0]]&&c[s[0]]!==s[1]&&(o=!1)),!0===o)l=l.replace(e[0],"");else{var a=e[0];a=a.replace("</if>","").replace(/<\s*if[^>]*>/g,""),l=l.replace(e[0],a)}}}});var e=_toConsumableArray(l.matchAll(/(\sdata-event=["|']\w.+)["|']/g));for(var n in e.forEach(function(e){e[0]&&-1<e.index&&(l=l.replace(e[0],"".concat(e[0]," data-id=").concat(t)))}),c){var s=new RegExp("{".concat(n,"}"),"gm");l=l.replace(s,c[n])}a+=l}):this.options.noRowsHTML&&(a+=this.options.noRowsHTML)),a}},{key:"findById",value:function(e){for(var t=0;t<this.rows.length;t++)if(this.rows[t].id===e)return this.rows[t];return null}},{key:"handleClick",value:function(e){var t=this;if(e.target.classList.contains("clickable")){var n=e.target.getAttribute("data-event");if(n){n=n.split("(");var s,i=[],o=e.target.getAttribute("data-id");if(n[1]&&(n[1]=n[1].replace(")",""),i=n[1].split(",")),n=n[0],i=i.map(function(e){return"string"!=typeof e&&"number"!=typeof e?t.rows[+o]&&(e=t.rows[+o][e]):"string"==typeof e&&(e=e.replace(/"/g,"").replace(/'/g,"")),e}),e.target.classList.contains("clickable")&&this.options.listeners.click[n])e.stopPropagation(),(s=this.options.listeners.click[n]).call.apply(s,[this,e,this.rows[+o]].concat(_toConsumableArray(i)))}}}},{key:"render",value:function(){var t=this;this.options.entity?this.apiService.get(this.options.entity).then(function(e){t.rows=e.rows,t.resize()}):this.resize()}},{key:"resize",value:function(){var e=this.buildHTML(this.rows);document.getElementById(this.elementId).innerHTML=e.replace(/\n/g,"")}},{key:"data",set:function(e){this.rows=e||[],this.render()},get:function(){return this.rows}}]),i}(),WebsyPubSub=function(){function n(e,t){_classCallCheck(this,n),this.options=_extends({},t),e?(this.elementId=e,this.subscriptions={}):console.log("No element Id provided")}return _createClass(n,[{key:"publish",value:function(e,t){this.subscriptions[e]&&this.subscriptions[e].forEach(function(e){e(t)})}},{key:"subscribe",value:function(e,t){this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t)}}]),n}(),APIService=function(){function t(e){_classCallCheck(this,t),this.baseUrl=e}return _createClass(t,[{key:"add",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=this.buildUrl(e);return this.run("POST",s,t,n)}},{key:"buildUrl",value:function(e,t,n){return void 0===n&&(n=[]),t&&n.push("id:".concat(t)),"".concat(this.baseUrl,"/").concat(e).concat(0<n.length?"?where=".concat(n.join(";")):"")}},{key:"delete",value:function(e,t){var n=this.buildUrl(e,t);return this.run("DELETE",n)}},{key:"get",value:function(e,t,n){var s=this.buildUrl(e,t,n);return this.run("GET",s)}},{key:"update",value:function(e,t,n){var s=this.buildUrl(e,t);return this.run("PUT",s,n)}},{key:"fetchData",value:function(e,t,n){3<arguments.length&&void 0!==arguments[3]&&arguments[3];return fetch(t,{method:e,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"run",value:function(i,o,a){var c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},l=4<arguments.length&&void 0!==arguments[4]&&arguments[4];return new Promise(function(t,n){var s=new XMLHttpRequest;if(s.open(i,o),s.setRequestHeader("Content-Type","application/json"),s.responseType="text",c.responseType&&(s.responseType=c.responseType),c.headers)for(var e in c.headers)s.setRequestHeader(e,c.headers[e]);s.withCredentials=!0,console.log("using this"),s.onload=function(){if(401!==s.status){var e="text"===s.responseType?s.responseText:s.response;if(""!==e&&"null"!==e)try{e=JSON.parse(e)}catch(e){}else e=[];e.err?n(JSON.stringify(e)):t(!0===l?[e,function(e){e=e.split("\r\n");var t={};return e.forEach(function(e){2===(e=e.split(":")).length&&(t[e[0]]=e[1].trim())}),t}(s.getAllResponseHeaders())]:e)}else n("401 - Unathorized")},s.onerror=function(){return n(s.statusText)},a?s.send(JSON.stringify(a)):s.send()})}}]),t}(),WebsyDesigns={WebsyPopupDialog:WebsyPopupDialog,WebsyLoadingDialog:WebsyLoadingDialog,WebsyNavigationMenu:WebsyNavigationMenu,WebsyForm:WebsyForm,WebsyDatePicker:WebsyDatePicker,WebsyDropdown:WebsyDropdown,WebsyResultList:WebsyResultList,WebsyPubSub:WebsyPubSub,APIService:APIService},GlobalPubSub=new WebsyPubSub("empty",{});function recaptchaReadyCallBack(){GlobalPubSub.publish("recaptchaready")}var rcs=document.createElement("script");rcs.src="//www.google.com/recaptcha/api.js?onload=recaptchaReadyCallBack",document.getElementsByTagName("body")[0].appendChild(rcs);var pps=document.createElement("script");rcs.src="//www.paypal.com/sdk/js",document.getElementsByTagName("body")[0].appendChild(pps);